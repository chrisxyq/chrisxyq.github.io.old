---
layout: post
title: Dubbo
date:  2021-01-01
catalog: true
tags:
    - RPC
---

### Dubbo简介（RPC框架：通讯+序列化

#### 特性：

负载均衡

面向接口代理的RPC调用：屏蔽远程调用细节

注册中心：服务注册与发现

可视化界面、流量调度、可扩展

#### 架构：

![image-20210808141649544](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808141649544.png)



#### 组件-zookeeper注册中心（默认端口2181

启动zookeeper

![image-20210808145550450](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808145550450.png)



#### 组件-ops监控中心（非必须、需要启动zookeeper

下载下来后，修改zookeeper地址为本机服务器2181端口

![image-20210808145053484](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808145053484.png)

打jar包

![image-20210808144855281](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808144855281.png)

java -jar运行jar包

![image-20210808145149726](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808145149726.png)

进入管理控制台，账户密码都是root

![image-20210808145256075](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808145256075.png)

### spring demo

#### 1.分包

![image-20210808154158001](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808154158001.png)

把所有的服务的接口和实体类放到这个包，使得服务提供者和消费者均可以引用，具体操作如下

![image-20210808154447514](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808154447514.png)

具体服务的实现放到服务提供者项目里面，由zookeeper获取服务提供者的实际地址

#### 2.服务暴露：将服务提供者注册到注册中心

##### 服务提供者项目的pom文件：引入dubbo依赖和zookeeper的客户端

![image-20210808150109113](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808150109113.png)

##### dubbo配置文件：配置应用名、注册中心地址、与消费者通信规则、要暴露的服务（dubbo提供了一系列标签

![image-20210808150530359](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808150530359.png)

![image-20210808150719748](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808150719748.png)

##### 测试：启动ioc容器（读取类路径下配置文件

system.read是为了不让程序终止

启动后可以在管理控制台看到服务提供者已经注册上去

![image-20210808152658840](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808152658840.png)

#### 3.消费者

##### 服务消费者项目的pom文件：同上



##### dubbo配置文件：配置应用名、注册中心地址、需要调用的远程服务（生成远程服务代理

1.包扫描配置是为了将消费者服务的bean注册到容器

2.会从zookeeper获取远程服务的调用地址，生成远程服务代理

![image-20210808153535610](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808153535610.png)

dubbo：reference配置有check属性，若check为false，则在实际调用时才检查要调用的远程服务是否存在

或通过dubbo：consumer标签配置是否检查

![image-20210808180107321](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808180107321.png)

##### 测试：启动ioc容器（读取类路径下配置文件

![image-20210808154008018](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808154008018.png)

![image-20210808153835796](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808153835796.png)

### springBoot demo

#### 1.分包（同spring

#### 2.服务方

##### pom文件：引入dubbo的starter即可

##### dubbo配置文件：（@service注解配置要暴露的服务，其余同上

用注解取代dubbo service标签，更方便地配置要暴露的服务

![image-20210808155709282](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808155709282.png)

dubbo配置文件如下（配置应用名、注册中心地址、与消费者通信规则：

![image-20210808155735870](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808155735870.png)

##### 测试：启动主启动类（@EnableDubbo注解

![image-20210808160056860](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808160056860.png)

#### 3.消费方

##### pom文件：引入dubbo的starter即可

##### dubbo配置文件：（@reference注解配置要调用的远程服务，其余同上

![image-20210808161301341](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808161301341.png)

##### 测试：启动主启动类（@EnableDubbo注解

![image-20210808161430619](https://gitee.com/chrisxyq/picgo/raw/master/https://gitee.com/chrisxyq/image-20210808161430619.png)